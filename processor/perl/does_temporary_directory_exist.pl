#!/usr/local/bin/perl

#  Copyright 2016, by the California Institute of Technology.  ALL RIGHTS
#  RESERVED. United States Government Sponsorship acknowledged. Any commercial
#  use must be negotiated with the Office of Technology Transfer at the
#  California Institute of Technology.
#
# $Id$
# DO NOT EDIT THE LINE ABOVE - IT IS AUTOMATICALLY GENERATED BY CM

# Function returns 1 if the the temporary log directory exists in SCRATCH_AREA.
#
#------------------------------------------------------------------------------------------------

sub does_temporary_directory_exist {

    #
    # Get input(s).
    #
    
    my $i_datasource        = lc($_[0]);

    my $o_directory_exist_flag = 0;

    my $debug_module = "does_temporary_directory_exist:";
    my $debug_mode   = 0; 

    #
    # Local variables.
    #

    my $RUN_LOGS_DIR     = "current_logs";  # Directory sub to scratch_area.
    my $scratch_area     = $ENV{SCRATCH_AREA}; 
    my $log_dir          = $scratch_area . "/" . $RUN_LOGS_DIR;
    my $processing_directory = $log_dir . "/" . "__" . $ENV{RANDOM_NUMBER} . "." . $i_datasource;

    if ($debug_mode) {
       print $debug_module . "random number $ENV{RANDOM_NUMBER}\n";
       print $debug_module . "i_datasource   $i_datasource\n";
       print $debug_module . "processing_directory $processing_directory\n";
    }
    if (-d $processing_directory) {
        $o_directory_exist_flag = 1;
    }

    # ---------- Close up shop ----------
    return($o_directory_exist_flag);
}

# Main program calls the subroutine defined above.
my $debug_module = "does_temporary_directory_exist:";
my $module_name  = "does_temporary_directory_exist.pl";

if (index($0,$module_name) >= 0)
{
    my $i_current_time      = "1474997057";
    my $i_datasource        = "refined_viirs";
    my $RUN_LOGS_DIR     = "current_logs";  # Directory sub to scratch_area.
    my $scratch_area     = $ENV{SCRATCH_AREA};
    my $log_dir          = $scratch_area . "/" . $RUN_LOGS_DIR;
    my $processing_directory = $log_dir . "/" . "__" . $i_current_time . "." . $i_datasource;
    # Create a directory so we can check it.
    print $debug_module . "mkdir($processing_directory)\n";
    mkdir($processing_directory);
    my $o_directory_exist_flag = does_temporary_directory_exist($i_current_time,
                                                                $i_datasource);

    print $debug_module . "i_current_time $i_current_time\n";
    print $debug_module . "i_datasource   $i_datasource\n";
    print $debug_module . "o_directory_exist_flag $o_directory_exist_flag\n";
    if ($o_directory_exist_flag) {
        print $debug_module . "rmdir($processing_directory)\n";
        rmdir($processing_directory);
        print "Unit test passed.  Expected temporary directory to exist and it does.\n";
    } else {
        print "Unit test failed.  Expected temporary directory to exist but it does not.\n";
        exit(0);
    }

    # Call the function does_temporary_directory_exist() again to get a non-existence file.

    my $o_directory_exist_flag = does_temporary_directory_exist($i_current_time,
                                                                $i_datasource);

    print $debug_module . "i_current_time $i_current_time\n";
    print $debug_module . "i_datasource   $i_datasource\n";
    print $debug_module . "o_directory_exist_flag $o_directory_exist_flag\n";
    if ($o_directory_exist_flag eq 0) {
        print "Unit test passed.  Expected temporary directory to not exist.\n";
    } else {
        print "Unit test failed.  Expected temporary directory to not exist but it does.\n";
    }
}
