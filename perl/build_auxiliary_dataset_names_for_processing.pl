#! /usr/local/bin/perl

#  Copyright 2007, by the California Institute of Technology.  ALL RIGHTS
#  RESERVED. United States Government Sponsorship acknowledged. Any commercial
#  use must be negotiated with the Office of Technology Transfer at the
#  California Institute of Technology.
#
# $Id: build_auxiliary_dataset_names_for_processing.pl,v 1.3 2007/08/08 15:04:11 qchau Exp $
# DO NOT EDIT THE LINE ABOVE - IT IS AUTOMATICALLY GENERATED BY CM

#
# Function build the names of MODIS dataset to process.
#
# Assumption:
#
#   1) Global variables:
#       $over_write_processed_modis_files
#       $NUM_FILES_TO_PROCESS
#   2) 
#
#------------------------------------------------------------------------------------------------

do "$GHRSST_PERL_LIB_DIRECTORY/modis_parse_filename_for_start_time.pl";
do "$GHRSST_PERL_LIB_DIRECTORY/create_modis_l2p_core_output_structure.pl";

sub  build_auxiliary_dataset_names_for_processing {

    #
    # Get input.
    #

    my $i_l2p_core_output_directory = shift;
    my $i_output_yyyy               = shift;
    my $i_output_doy                = shift;
    my $i_modis_fullpathname        = shift;
    my $i_scratch_area              = shift;
    
    #
    # Returned array(s) and variable(s).
    #

    my $r_new_hdf_filename = ''; 

    # Local variables(s):

    # Create a directory if one does not already exist.

    create_modis_l2p_core_output_structure($i_l2p_core_output_directory,$i_output_yyyy,$i_output_doy);

    #
    # Get just the file name (minus the directory).
    #

    # The name has directory.  Extract just the name.

    my $l_modis_data_filename = fileparse($i_modis_fullpathname);

    # Create the name without the .bz2 extension.  Get from beginning
    # and stop before the .bz2 (which is 4 characters long).

    my $l_after_bunzip_data_filename = $l_modis_data_filename; 
    if (index($l_modis_data_filename,".bz2") >= 0) {
        $l_after_bunzip_data_filename = substr($l_modis_data_filename,0,length($l_modis_data_filename) - 4);
    }

    # Build the full HDF file name with directory.

    $r_new_hdf_filename = $i_scratch_area . "/" . $l_after_bunzip_data_filename;

    # Remove .bz2 file if it exists.

    if (-e "$i_scratch_area/$l_modis_data_filename") {
        print "build_auxiliary_dataset_names_for_processing.pro - INFO: Removing file $i_scratch_area/$l_modis_data_filename\n";
        unlink("$i_scratch_area" . "/" . $l_modis_data_filename);
    }

    #
    # Parse the file name for year, month, day, hour, minute and second.
    #
    
    my ($l_status,
        $r_start_time_array_element,
        $r_global_start_date_utc,
        $r_global_start_time_utc) = modis_parse_filename_for_start_time($l_modis_data_filename);

    return ($r_new_hdf_filename,
            $r_start_time_array_element,
            $r_global_start_date_utc,
            $r_global_start_time_utc);
}
